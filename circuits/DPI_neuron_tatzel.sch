v {xschem version=2.9.9 file_version=1.2 

* Copyright 2020 Stefan Frederik Schippers
* 
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     https://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.

}
G {}
K {}
V {}
S {}
E {}
N 2200 -800 2200 -770 { lab=#net1}
N 1240 -920 1240 -890 { lab=vdd}
N 1360 -920 1360 -890 { lab=vdd}
N 1120 -920 1120 -890 { lab=vdd}
N 2200 -740 2220 -740 { lab=vdd}
N 2200 -860 2220 -860 { lab=vdd}
N 2340 -860 2360 -860 { lab=vdd}
N 2340 -740 2360 -740 { lab=vdd}
N 2040 -920 2040 -890 { lab=vdd}
N 2200 -920 2200 -890 { lab=vdd}
N 2340 -920 2340 -890 { lab=vdd}
N 2020 -860 2040 -860 { lab=vdd}
N 2120 -860 2160 -860 { lab=#net1}
N 2120 -800 2200 -800 { lab=#net1}
N 2120 -860 2120 -800 { lab=#net1}
N 2020 -620 2040 -620 { lab=vdd}
N 2220 -860 2220 -740 { lab=vdd}
N 2360 -860 2360 -740 { lab=vdd}
N 2200 -830 2200 -800 { lab=#net1}
N 2340 -800 2340 -770 { lab=#net2}
N 2360 -920 2360 -860 { lab=vdd}
N 2220 -920 2220 -860 { lab=vdd}
N 2020 -920 2020 -860 { lab=vdd}
N 2040 -830 2040 -650 { lab=#net3}
N 2020 -860 2020 -620 { lab=vdd}
N 2040 -540 2040 -290 { lab=vmem}
N 2200 -560 2200 -470 { lab=Vna}
N 2340 -500 2340 -470 { lab=Vk}
N 2140 -740 2160 -740 { lab=vmem}
N 2140 -540 2140 -440 { lab=vmem}
N 2140 -440 2160 -440 { lab=vmem}
N 2280 -740 2300 -740 { lab=Vna}
N 2280 -560 2280 -440 { lab=Vna}
N 2280 -440 2300 -440 { lab=Vna}
N 2200 -560 2280 -560 { lab=Vna}
N 2080 -620 2200 -620 { lab=Vna}
N 2100 -500 2340 -500 { lab=Vk}
N 2100 -500 2100 -260 { lab=Vk}
N 2080 -260 2100 -260 { lab=Vk}
N 2200 -380 2200 -290 { lab=#net4}
N 2340 -410 2340 -290 { lab=#net5}
N 2020 -260 2040 -260 { lab=vss}
N 2020 -260 2020 -200 { lab=vss}
N 2200 -260 2220 -260 { lab=vss}
N 2220 -260 2220 -200 { lab=vss}
N 2340 -260 2360 -260 { lab=vss}
N 2360 -260 2360 -200 { lab=vss}
N 2340 -230 2340 -200 { lab=vss}
N 2200 -230 2200 -200 { lab=vss}
N 2040 -230 2040 -200 { lab=vss}
N 1400 -260 1420 -260 { lab=vrefr}
N 1420 -320 1420 -260 { lab=vrefr}
N 2280 -260 2300 -260 { lab=vrefr}
N 2280 -320 2280 -260 { lab=vrefr}
N 1360 -320 1360 -290 { lab=vrefr}
N 2080 -860 2120 -860 { lab=#net1}
N 2200 -620 2200 -560 { lab=Vna}
N 2280 -740 2280 -560 { lab=Vna}
N 2200 -710 2200 -620 { lab=Vna}
N 2340 -710 2340 -500 { lab=Vk}
N 1360 -320 1420 -320 { lab=vrefr}
N 1820 -260 1840 -260 { lab=vss}
N 1840 -260 1840 -200 { lab=vss}
N 1820 -230 1820 -200 { lab=vss}
N 1340 -260 1360 -260 { lab=vss}
N 1340 -260 1340 -200 { lab=vss}
N 1360 -230 1360 -200 { lab=vss}
N 1280 -260 1300 -260 { lab=vleak}
N 1220 -260 1240 -260 { lab=vss}
N 1220 -260 1220 -200 { lab=vss}
N 1240 -230 1240 -200 { lab=vss}
N 1240 -340 1240 -290 { lab=vleak}
N 1760 -340 1760 -260 { lab=vleak}
N 1300 -340 1760 -340 { lab=vleak}
N 1240 -830 1240 -340 { lab=vleak}
N 1360 -830 1360 -320 { lab=vrefr}
N 1300 -340 1300 -260 { lab=vleak}
N 1420 -320 2280 -320 { lab=vrefr}
N 1240 -340 1300 -340 { lab=vleak}
N 1100 -260 1120 -260 { lab=vss}
N 1100 -260 1100 -200 { lab=vss}
N 1120 -230 1120 -200 { lab=vss}
N 1120 -360 1120 -290 { lab=vgain}
N 1160 -260 1180 -260 { lab=vgain}
N 1180 -360 1180 -260 { lab=vgain}
N 1820 -410 1820 -280 { lab=#net6}
N 1940 -540 2040 -540 { lab=vmem}
N 1820 -540 1820 -470 { lab=vmem}
N 1120 -360 1180 -360 { lab=vgain}
N 2040 -590 2040 -540 { lab=vmem}
N 1120 -830 1120 -360 { lab=vgain}
N 1860 -440 1880 -440 { lab=vmem}
N 1880 -540 1880 -440 { lab=vmem}
N 1700 -410 1700 -200 { lab=vss}
N 1640 -440 1660 -440 { lab=vgain}
N 1640 -440 1640 -360 { lab=vgain}
N 1180 -360 1640 -360 { lab=vgain}
N 1800 -440 1820 -440 { lab=vdd}
N 1700 -540 1820 -540 { lab=vmem}
N 1700 -540 1700 -470 { lab=vmem}
N 1820 -540 1880 -540 { lab=vmem}
N 2440 -500 2440 -470 { lab=Vk}
N 2340 -500 2440 -500 { lab=Vk}
N 2440 -410 2440 -200 { lab=vss}
N 2360 -200 2440 -200 { lab=vss}
N 2340 -920 2360 -920 { lab=vdd}
N 1940 -410 1940 -200 { lab=vss}
N 1940 -540 1940 -470 { lab=vmem}
N 2140 -260 2160 -260 { lab=#net4}
N 2140 -380 2140 -260 { lab=#net4}
N 2140 -380 2200 -380 { lab=#net4}
N 1120 -920 1240 -920 { lab=vdd}
N 1240 -920 1360 -920 { lab=vdd}
N 2020 -920 2040 -920 { lab=vdd}
N 2040 -920 2200 -920 { lab=vdd}
N 2220 -920 2340 -920 { lab=vdd}
N 2200 -920 2220 -920 { lab=vdd}
N 1940 -200 2020 -200 { lab=vss}
N 2200 -200 2220 -200 { lab=vss}
N 2340 -200 2360 -200 { lab=vss}
N 2220 -200 2340 -200 { lab=vss}
N 2040 -200 2200 -200 { lab=vss}
N 2020 -200 2040 -200 { lab=vss}
N 1820 -200 1840 -200 { lab=vss}
N 1700 -200 1820 -200 { lab=vss}
N 1240 -200 1340 -200 { lab=vss}
N 1340 -200 1360 -200 { lab=vss}
N 1120 -200 1220 -200 { lab=vss}
N 1220 -200 1240 -200 { lab=vss}
N 1100 -200 1120 -200 { lab=vss}
N 1840 -200 1940 -200 { lab=vss}
N 1880 -540 1940 -540 { lab=vmem}
N 2200 -410 2200 -380 { lab=#net4}
N 2200 -440 2220 -440 { lab=vss}
N 2220 -440 2220 -260 { lab=vss}
N 2340 -440 2360 -440 { lab=vss}
N 2360 -440 2360 -260 { lab=vss}
N 1760 -260 1780 -260 { lab=vleak}
N 2280 -860 2300 -860 { lab=#net2}
N 2280 -860 2280 -800 { lab=#net2}
N 2280 -800 2340 -800 { lab=#net2}
N 2040 -540 2140 -540 { lab=vmem}
N 1000 -920 1000 -890 { lab=vdd}
N 1000 -920 1120 -920 { lab=vdd}
N 1000 -830 1000 -290 { lab=#net7}
N 1000 -230 1000 -200 { lab=vss}
N 1000 -200 1100 -200 { lab=vss}
N 2340 -830 2340 -800 { lab=#net2}
N 2140 -740 2140 -540 { lab=vmem}
N 740 -920 1000 -920 { lab=vdd}
N 1800 -920 2020 -920 { lab=vdd}
N 1360 -200 1700 -200 { lab=vss}
N 570 -300 710 -300 { lab=0}
N 680 -320 710 -320 { lab=in}
N 570 -320 600 -320 { lab=vref}
N 1800 -920 1800 -440 { lab=vdd}
N 1720 -920 1800 -920 { lab=vdd}
N 1720 -920 1720 -440 { lab=vdd}
N 1700 -920 1720 -920 { lab=vdd}
N 1700 -440 1720 -440 { lab=vdd}
N 740 -200 1000 -200 { lab=vss}
N 540 -200 740 -200 { lab=vss}
N 740 -250 740 -200 { lab=vss}
N 1700 -920 1700 -890 { lab=vdd}
N 1360 -920 1700 -920 { lab=vdd}
N 680 -480 700 -480 { lab=refbias}
N 680 -520 700 -520 { lab=vdd}
N 540 -250 540 -200 { lab=vss}
N 540 -920 740 -920 { lab=vdd}
N 680 -480 680 -440 { lab=refbias}
N 540 -440 680 -440 { lab=refbias}
N 540 -470 540 -440 { lab=refbias}
N 740 -920 740 -890 { lab=vdd}
N 740 -830 740 -530 { lab=#net8}
N 740 -470 740 -360 { lab=resbias}
N 540 -440 540 -370 { lab=refbias}
N 540 -920 540 -530 { lab=vdd}
N 680 -560 680 -520 { lab=vdd}
N 540 -560 680 -560 { lab=vdd}
N 1700 -830 1700 -720 { lab=#net9}
N 1700 -660 1700 -540 { lab=vmem}
C {devices/code_shown.sym} 0 -890 0 0 {name=ngspice 
only_toplevel=true 
value=" 
.options gmin=1e-15 abstol=10f
.option savecurrents
vvss vss 0 0
vpref vref 0 60
Vin in vref dc 0 ac 0.25 sin(0 55 1)
.control
save all
op
write DPI_neuron_tatzel.op.raw
*dc vpressure 0.01 120 0.1
tran  10u 2
write DPI_neuron_tatzel.raw
wrdata spikes_DPI.csv all.vmem
wrdata pressure_DPI.csv all.Input
*plot -all.Vres/all.Vres#branch 
plot v(in)
plot all.Vmeas#branch
plot all.Vineuron#branch
plot Vmeas#branch/Vineuron#branch
plot vmem Vna Vk
*plot all.vdd_meas#branch*all.vdd
.endc
"}
C {devices/code.sym} 110 -350 0 0 {name=TT_MODELS
only_toplevel=true
format="tcleval( @value )"
value=".lib \\\\$::SKYWATER_MODELS\\\\/models/sky130.lib.spice tt

.param mc_mm_switch=0
.param mc_pr_switch=1

"}
C {devices/ammeter.sym} 740 -860 0 1 {name=Vmeas}
C {devices/ammeter.sym} 1000 -260 2 0 {name=vdd_meas}
C {devices/vsource.sym} 1000 -860 0 0 {name=V1 value=1.2
}
C {sky130_fd_pr/nfet_01v8.sym} 1800 -260 0 0 {name=M1
L=2
W=2
nf=1 
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8.sym} 2180 -260 0 0 {name=M2
L=2
W=2
nf=1 
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8.sym} 2180 -440 0 0 {name=M3
L=2
W=2
nf=1 
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/cap_mim_m3_1.sym} 1940 -440 0 0 {name=C1 model=cap_mim_m3_1 W=10 L=10 MF=1 spiceprefix=X}
C {sky130_fd_pr/cap_mim_m3_1.sym} 2440 -440 0 0 {name=C2 model=cap_mim_m3_1 W=2 L=2 MF=1 spiceprefix=X}
C {sky130_fd_pr/nfet_01v8.sym} 2060 -260 0 1 {name=M14
L=5
W=0.5
nf=1 
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {devices/lab_pin.sym} 2200 -620 0 1 {name=l2 lab=Vna}
C {devices/lab_pin.sym} 2100 -500 0 0 {name=l6 lab=Vk}
C {devices/lab_pin.sym} 1700 -540 0 0 {name=l18 lab=vmem}
C {sky130_fd_pr/nfet_01v8.sym} 2320 -260 0 0 {name=M4
L=2
W=2
nf=1 
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8.sym} 2320 -440 0 0 {name=M5
L=2
W=2
nf=1 
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {devices/isource.sym} 1240 -860 0 1 {name=I2 value=0.001n
}
C {sky130_fd_pr/nfet_01v8.sym} 1260 -260 0 1 {name=M15
L=2
W=2
nf=1 
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {devices/isource.sym} 1360 -860 0 1 {name=I3 value=0.01n

}
C {sky130_fd_pr/nfet_01v8.sym} 1380 -260 0 1 {name=M16
L=2
W=2
nf=1 
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {devices/isource.sym} 1120 -860 0 1 {name=I4 value=0.1n
}
C {sky130_fd_pr/nfet_01v8.sym} 1140 -260 0 1 {name=M17
L=2
W=2
nf=1 
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {devices/lab_pin.sym} 1120 -360 0 0 {name=l23 sig_type=std_logic lab=vgain}
C {devices/lab_pin.sym} 1240 -340 0 0 {name=l24 sig_type=std_logic lab=vleak}
C {devices/lab_pin.sym} 1360 -320 0 0 {name=l25 sig_type=std_logic lab=vrefr}
C {sky130_fd_pr/pfet_01v8.sym} 2180 -740 0 0 {name=M6
L=2
W=2
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2180 -860 0 0 {name=M7
L=2
W=4
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2320 -860 0 0 {name=M8
L=2
W=2
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2320 -740 0 0 {name=M9
L=2
W=2
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2060 -860 0 1 {name=M10
L=2
W=4
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2060 -620 0 1 {name=M11
L=2
W=2
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 1840 -440 0 1 {name=M12
L=2
W=2
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 1680 -440 0 0 {name=M13
L=2
W=2
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {/home/cmaier/.xschem/sky130_TAC3/circuits/piezoresistor.sym} 830 -310 0 0 {name=x1}
C {devices/isource.sym} 540 -500 0 1 {name=I1 value=1u}
C {/home/cmaier/.xschem/sky130_TAC3/circuits/piezoresistor.sym} 450 -310 0 1 {name=x2}
C {devices/lab_wire.sym} 630 -300 2 0 {name=l3 lab=0}
C {devices/lab_pin.sym} 680 -320 0 0 {name=l4 lab=in}
C {devices/lab_pin.sym} 600 -320 0 1 {name=l7 lab=vref}
C {devices/lab_pin.sym} 540 -400 0 0 {name=l8 lab=refbias}
C {devices/lab_pin.sym} 740 -400 0 0 {name=l9 lab=resbias}
C {devices/title.sym} 200 -80 0 0 {name=l10 author="Michele Mastella, Christoph Maier"}
C {devices/lab_wire.sym} 1540 -920 0 0 {name=l11 lab=vdd}
C {devices/lab_wire.sym} 1540 -200 0 0 {name=l12 lab=vss}
C {devices/cccs.sym} 1700 -860 0 1 {name=F1 vnam=vmeas value=1u}
C {devices/vcvs.sym} 740 -500 0 0 {name=E1 value=1}
C {devices/ammeter.sym} 1700 -690 0 1 {name=Vineuron}
